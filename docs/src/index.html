<!DOCTYPE html>

<html>
<head>
  <title>parse-ts</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="../style.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          
          <h1 id="parse-ts">parse-ts</h1>
<p>Type-safe parsing of JSON-compatible runtime data.</p>

          
            <div class='highlight'><pre><span class="hljs-keyword">import</span> {some, none, Option, isSome, map} <span class="hljs-keyword">from</span> <span class="hljs-string">'fp-ts/lib/Option'</span>;
<span class="hljs-keyword">import</span> {filterMap} <span class="hljs-keyword">from</span> <span class="hljs-string">'fp-ts/lib/Array'</span>;
<span class="hljs-keyword">import</span> {flow} <span class="hljs-keyword">from</span> <span class="hljs-string">'fp-ts/lib/function'</span>;</pre></div>
          
        

        
      </div>

      
        
        <h3 id="validator-type">Validator type</h3>
<p>Type of functions that validate <code>unknown</code> data. Returns Option from ‘fp-ts’.</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> Validator&lt;U = never&gt; = <span class="hljs-function">(<span class="hljs-params">x: unknown</span>) =&gt;</span> Option&lt;U&gt;;</pre></div>
        
      
        
        <h3 id="str">str</h3>
<p>Validate string</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> str: Validator&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span>
    <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'string'</span> ? some(v) : none;</pre></div>
        
      
        
        <h3 id="num">num</h3>
<p>Validate number</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> num: Validator&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span>
    <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'number'</span> ? some(v) : none;</pre></div>
        
      
        
        <h3 id="exactly">exactly</h3>
<p>Validate that value matches the passed one. Uses <code>Object.is</code></p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> exactly = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">val: T</span>) =&gt;</span> (v: <span class="hljs-built_in">any</span>): Option&lt;T&gt; =&gt;
    <span class="hljs-built_in">Object</span>.is(v, val) ? some(v) : none;</pre></div>
        
      
        
        <h3 id="nil">nil</h3>
<p>Validate that value is null</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> nil: Validator&lt;<span class="hljs-literal">null</span>&gt; = exactly(<span class="hljs-literal">null</span>);</pre></div>
        
      
        
        <h3 id="bool">bool</h3>
<p>Validate boolean</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> bool: Validator&lt;<span class="hljs-built_in">boolean</span>&gt; = <span class="hljs-function"><span class="hljs-params">v</span> =&gt;</span>
    <span class="hljs-keyword">typeof</span> v === <span class="hljs-string">'boolean'</span> ? some(v) : none;</pre></div>
        
      
        
        <h3 id="f">F</h3>
<p>Validate that value is false</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> F: Validator&lt;<span class="hljs-literal">false</span>&gt; = exactly(<span class="hljs-literal">false</span>);</pre></div>
        
      
        
        <h3 id="t">T</h3>
<p>Validate the value is true</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> T: Validator&lt;<span class="hljs-literal">true</span>&gt; = exactly(<span class="hljs-literal">true</span>);</pre></div>
        
      
        
        <h3 id="arrayof">arrayOf</h3>
<p>Validates that all values of a potential array match the passed validator</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> arrayOf = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">childValidator: Validator&lt;T&gt;</span>) =&gt;</span> (v: unknown): Option&lt;T[]&gt; =&gt;{
    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">Array</span>.isArray(v)){
        <span class="hljs-keyword">const</span> cleaned = filterMap(childValidator)(v);
        <span class="hljs-keyword">if</span>(cleaned.length === v.length) {
            <span class="hljs-keyword">return</span> some(v);
        }
    }
    <span class="hljs-keyword">return</span> none;
};</pre></div>
        
      
        
        <h3 id="recordspec-type">RecordSpec type</h3>
<p>A mapping of object keys to validators for it’s values.
Pass the desired interface as the generic to ensure validator is correct</p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">type</span> RecordSpec&lt;T = never&gt; = {[K <span class="hljs-keyword">in</span> keyof T]: Validator&lt;T[K]&gt;};

<span class="hljs-keyword">type</span> ValidatedRecord&lt;T&gt; = {[K <span class="hljs-keyword">in</span> keyof T]: Option&lt;T[K]&gt;};

<span class="hljs-keyword">const</span> isPlainObject = (obj: unknown): obj is Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt; =&gt;
	<span class="hljs-built_in">Object</span>.prototype.toString.call(obj) === <span class="hljs-string">'[object Object]'</span>;

<span class="hljs-keyword">const</span> hasOwnProperty = (k: <span class="hljs-built_in">string</span>, v: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">any</span>&gt;): v is Record&lt;<span class="hljs-keyword">typeof</span> k, unknown&gt; =&gt;
    <span class="hljs-built_in">Object</span>.prototype.hasOwnProperty.call(v, k);

<span class="hljs-keyword">const</span> validateObj = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">mapping: RecordSpec&lt;T&gt;</span>) =&gt;</span> (v: {}): ValidatedRecord&lt;T&gt; =&gt; {
    <span class="hljs-keyword">const</span> part: Partial&lt;ValidatedRecord&lt;T&gt;&gt; = {};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> k <span class="hljs-keyword">in</span> mapping){
        part[k] = hasOwnProperty(k, v) ? mapping[k](v[k]) : none;
    }</pre></div>
        
      
        
        <p>Force after going over every key</p>

        
          <div class='highlight'><pre>    <span class="hljs-keyword">return</span> part <span class="hljs-keyword">as</span> ValidatedRecord&lt;T&gt;;
}

<span class="hljs-keyword">const</span> extractValidatedRecord = &lt;T&gt;(rec: ValidatedRecord&lt;T&gt;): Option&lt;T&gt; =&gt; {
    <span class="hljs-keyword">const</span> part: Partial&lt;T&gt; = {};
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> k <span class="hljs-keyword">in</span> rec){
        <span class="hljs-keyword">if</span>(isSome(rec[k])){
             map(<span class="hljs-function">(<span class="hljs-params">a: T[<span class="hljs-keyword">typeof</span> k]</span>) =&gt;</span> {
                part[k] = a;
            })(rec[k]);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> none;
        }
    }
    <span class="hljs-keyword">return</span> some(part <span class="hljs-keyword">as</span> T);
}</pre></div>
        
      
        
        <h3 id="record-recordspect---validatort">record: <code>RecordSpec&lt;T&gt; -&gt; Validator&lt;T&gt;</code></h3>
<p>Validate that a potential object matches the passed spec. </p>

        
          <div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> record = &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">mapping: RecordSpec&lt;T&gt;</span>) =&gt;</span> (v: unknown): Option&lt;T&gt; =&gt; {
    <span class="hljs-keyword">if</span>(!isPlainObject(v)) <span class="hljs-keyword">return</span> none;
    <span class="hljs-keyword">return</span> flow(
        validateObj(mapping),
        extractValidatedRecord
    )(v);
};</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
